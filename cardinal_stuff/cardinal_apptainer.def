Bootstrap: docker
From: ubuntu:24.04

%environment

    #If I need to recompile it.  
    export LIBMESH_JOBS=20
    export MOOSE_JOBS=20
    export JOBS=20
    export NEKRS_HOME=/opt/cardinal-build/cardinal/install
    export CC=mpicc
    export CXX=mpicxx
    export FC=mpif90
    export OPENMC_CROSS_SECTIONS=/opt/cardinal-build/cross_sections/endfb-viii.0-hdf5i/cross_sections.xml

%post

    #for build time compilation

    export LIBMESH_JOBS=20
    export MOOSE_JOBS=20
    export JOBS=20
    export NEKRS_HOME=/opt/cardinal-build/cardinal/install
    export CC=mpicc
    export CXX=mpicxx
    export FC=mpif90

    apt-get update -y && \
    apt-get install --yes \
        git \
        make \
        autoconf \
        automake \
        libtool \
        flex \
        bison \
        cmake \
        g++ \
        gfortran \
        libhdf5-dev \
        mpich \
        libtirpc-dev \
        python3 \
        python3-pip \
        python3-packaging \
        python3-jinja2 \
        python3-yaml \
        python3-pkgconfig \
        curl \
        nano \
        wget \
        apt-utils

    mkdir -p /opt/cardinal-build && cd /opt/cardinal-build

    mkdir cross_sections && cd cross_sections && \
    wget https://anl.box.com/shared/static/uhbxlrx7hvxqw27psymfbhi7bx7s6u6a.xz && \
    tar xf uhbxlrx7hvxqw27psymfbhi7bx7s6u6a.xz && \
    rm -f uhbxlrx7hvxqw27psymfbhi7bx7s6u6a.xz && \
    cd ../

    git clone https://github.com/magnoxemo/cardinal.git
    cd cardinal

    ./scripts/get-dependencies.sh && \
    ./contrib/moose/scripts/update_and_rebuild_petsc.sh && \
    ./contrib/moose/scripts/update_and_rebuild_libmesh.sh && \
    ./contrib/moose/scripts/update_and_rebuild_wasp.sh 


    make -j 12 

    cd contrib/openmc && \
    python -m pip install .
